<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="TblofficeAdminMapper_SQL">
	<resultMap id="BaseResultMap"
		type="com.dzpay.admin.common.dto.account.TblofficeAdmin">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Aug 04 
			15:36:05 KST 2020. -->
		<result column="ADMIN_ID" jdbcType="VARCHAR" property="adminId" />
		<result column="ADMIN_GP_NO" jdbcType="VARCHAR"
			property="adminGpNo" />
		<result column="ADMIN_PWD" jdbcType="VARCHAR"
			property="adminPwd" />
		<result column="ADMIN_NM" jdbcType="VARCHAR" property="adminNm" />
		<result column="SUB_DEPT" jdbcType="VARCHAR" property="subDept" />
		<result column="JOB_TIT" jdbcType="VARCHAR" property="jobTit" />
		<result column="EMAIL" jdbcType="VARCHAR" property="email" />
		<result column="COMP_TEL" jdbcType="VARCHAR" property="compTel" />
		<result column="MOB_TEL" jdbcType="VARCHAR" property="mobTel" />
		<result column="FAX_TEL" jdbcType="VARCHAR" property="faxTel" />
		<result column="USE_YN" jdbcType="VARCHAR" property="useYn" />
		<result column="REG_DT" jdbcType="TIMESTAMP" property="regDt" />
		<result column="REG_ID" jdbcType="VARCHAR" property="regId" />
		<result column="MOD_DT" jdbcType="TIMESTAMP" property="modDt" />
		<result column="ADMIN_TYPE" jdbcType="VARCHAR"
			property="adminType" />
		<result column="SITE_CD" jdbcType="VARCHAR" property="siteCd" />
		<result column="CORP_ID" jdbcType="VARCHAR" property="corpId" />
		<result column="VIEW_TYPE" jdbcType="VARCHAR"
			property="viewType" />
		<result column="SHOP_TYPE" jdbcType="VARCHAR"
			property="shopType" />
		<result column="SITE_HOSTING_ID" jdbcType="VARCHAR"
			property="siteHostingId" />
		<result column="CHURCH_YN" jdbcType="VARCHAR"
			property="churchYn" />
		<result column="PHONE_NO" jdbcType="VARCHAR" property="phoneNo" />
		<result column="ENC_SALT" jdbcType="VARCHAR" property="encSalt" />
	</resultMap>
	<insert id="insert"
		parameterType="com.dzpay.admin.common.dto.account.TblofficeAdmin">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Aug 04 
			15:36:05 KST 2020. -->
		insert into SKYPG.TBLOFFICE_ADMIN (ADMIN_ID, ADMIN_GP_NO, ADMIN_PWD,
		ADMIN_NM, SUB_DEPT, JOB_TIT,
		EMAIL, COMP_TEL, MOB_TEL,
		FAX_TEL, USE_YN,
		REG_DT,
		REG_ID, MOD_DT, ADMIN_TYPE,
		SITE_CD, CORP_ID, VIEW_TYPE,
		SHOP_TYPE, SITE_HOSTING_ID, CHURCH_YN,
		PHONE_NO, ENC_SALT)
		values
		(#{adminId,jdbcType=VARCHAR}, #{adminGpNo,jdbcType=VARCHAR},
		#{adminPwd,jdbcType=VARCHAR},
		#{adminNm,jdbcType=VARCHAR},
		#{subDept,jdbcType=VARCHAR}, #{jobTit,jdbcType=VARCHAR},
		#{email,jdbcType=VARCHAR}, #{compTel,jdbcType=VARCHAR},
		#{mobTel,jdbcType=VARCHAR},
		#{faxTel,jdbcType=VARCHAR},
		#{useYn,jdbcType=VARCHAR}, #{regDt,jdbcType=TIMESTAMP},
		#{regId,jdbcType=VARCHAR}, #{modDt,jdbcType=TIMESTAMP},
		#{adminType,jdbcType=VARCHAR},
		#{siteCd,jdbcType=VARCHAR},
		#{corpId,jdbcType=VARCHAR}, #{viewType,jdbcType=VARCHAR},
		#{shopType,jdbcType=VARCHAR}, #{siteHostingId,jdbcType=VARCHAR},
		#{churchYn,jdbcType=VARCHAR},
		#{phoneNo,jdbcType=VARCHAR},
		#{encSalt,jdbcType=VARCHAR})
	</insert>

	<select id="selectAll" resultMap="BaseResultMap">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Aug 04 
			15:36:05 KST 2020. -->
		select ADMIN_ID, ADMIN_GP_NO, ADMIN_PWD, ADMIN_NM, SUB_DEPT, JOB_TIT,
		EMAIL, COMP_TEL,
		MOB_TEL, FAX_TEL, USE_YN, REG_DT, REG_ID, MOD_DT,
		ADMIN_TYPE, SITE_CD,
		CORP_ID, VIEW_TYPE,
		SHOP_TYPE, SITE_HOSTING_ID,
		CHURCH_YN, PHONE_NO, ENC_SALT
		from SKYPG.TBLOFFICE_ADMIN
	</select>

	<select id="selectOne" resultMap="BaseResultMap">
		<!-- selectALL을 기반으로 수정하여 생성 -->
		select ADMIN_ID, ADMIN_GP_NO, ADMIN_PWD, ADMIN_NM, SUB_DEPT, JOB_TIT,
		EMAIL, COMP_TEL,
		MOB_TEL, FAX_TEL, USE_YN, REG_DT, REG_ID, MOD_DT,
		ADMIN_TYPE, SITE_CD,
		CORP_ID, VIEW_TYPE,
		SHOP_TYPE, SITE_HOSTING_ID,
		CHURCH_YN, PHONE_NO, ENC_SALT
		from SKYPG.TBLOFFICE_ADMIN
		WHERE ADMIN_ID
		= #{adminId}
	</select>

	<!-- 로그인 결과 쿼리 -->
	<select id="selectOneByAdminIdAndAdminPwd"
		resultMap="BaseResultMap">
		<!-- selectALL을 기반으로 수정하여 생성 -->
		select ADMIN_ID, ADMIN_GP_NO, ADMIN_PWD, ADMIN_NM, SUB_DEPT, JOB_TIT,
		EMAIL, COMP_TEL,
		MOB_TEL, FAX_TEL, USE_YN, REG_DT, REG_ID, MOD_DT,
		ADMIN_TYPE, SITE_CD,
		CORP_ID, VIEW_TYPE,
		SHOP_TYPE, SITE_HOSTING_ID,
		CHURCH_YN, PHONE_NO, ENC_SALT
		from SKYPG.TBLOFFICE_ADMIN
		WHERE ADMIN_ID
		= #{adminId} AND ADMIN_PWD = #{adminPwd}
	</select>

	<!-- 아이디 찾기 조회 -->
	<select id="selectByCorpIdAndEmail"
		parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT
		SUBSTR(M.ADMIN_ID,1,2) || lpad('*', LENGTH(M.ADMIN_ID)-2, '*') AS
		ADMIN_ID
		FROM TBLCORP_INFO C, TBLOFFICE_ADMIN M, TBLSITE_INFO S
		WHERE
		C.CORP_ID = M.CORP_ID AND S.CORP_ID = C.CORP_ID AND
		M.SITE_CD IS NOT
		NULL
		AND C.CORP_TAX_NO = #{corpTaxNo, jdbcType=VARCHAR}
		AND S.SITE_EMAIL
		= #{email, jdbcType=VARCHAR}
	</select>

	<!-- 비밀번호 찾기, 특정 계정을 조회 -->
	<select id="selectByCorpIdAndEmailAndId"
		parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT
		M.COMP_TEL AS phoneNumber
		FROM TBLCORP_INFO C, TBLOFFICE_ADMIN M, TBLSITE_INFO S
		WHERE
		C.CORP_ID =
		M.CORP_ID AND S.CORP_ID = C.CORP_ID AND
		M.SITE_CD IS NOT
		NULL
		AND
		C.CORP_TAX_NO = #{corpTaxNo, jdbcType=VARCHAR}
		AND S.SITE_EMAIL =
		#{email, jdbcType=VARCHAR}
		AND M.ADMIN_ID = #{adminId, jdbcType =
		VARCHAR}
	</select>

	<!-- SMS 문자 발송 1. 인증코드 2. 임시비밀번호 -->
	<insert id="insertSmsByForgetId"
		parameterType="java.util.HashMap">
		INSERT INTO
		MSG_QUEUE(
		MSEQ,
		REQUEST_TIME,
		TEXT,
		CALLBACK,
		MSG_TYPE,
		STAT,
		DSTADDR,
		SITE_CD,
		CORP_ID
		) VALUES (
		MSG_QUEUE_SEQ.NEXTVAL ,
		SYSDATE,
		'[더존Pay] 고객님의 ' ||
		#{requestType, jdbcType=VARCHAR} ||'는 ['
		|| #{secretCode, jdbcType=VARCHAR} || '] 입니다.',
		'0262330280',
		'1',
		'0',
		#{phoneNumber, jdbcType = VARCHAR},
		'E0015',
		'MK100002'
		)
	</insert>

	<!-- 임시비밀번호 발급으로 인한 패스워드 변경 -->
	<insert id="updateAdminPassword"
		parameterType="java.util.HashMap">
		UPDATE 
			SKYPG.TBLOFFICE_ADMIN
		SET
			ADMIN_PWD = #{newEncodedPassword, jdbcType=VARCHAR}
		WHERE
			ADMIN_ID = #{adminId, jdbcType=VARCHAR}
			AND Email = #{email, jdbcType=VARCHAR}
	</insert>

	<!-- sms 문자 메시지 인증 코드 생성 -->
	<insert id="insertAuthCode" parameterType="java.util.HashMap">
		INSERT INTO MSG_AUTH(
		ID,
		AUTHCODE,
		PHONENUMBER,
		REGDATE,
		EXPIREDATE
		) VALUES(
		MSGAUTHSEQ.NEXTVAL,
		#{secretCode, jdbcType =
		VARCHAR},
		#{phoneNumber, jdbcType = VARCHAR},
		SYSDATE,
		SYSDATE + 10/24/60
		)
	</insert>

	<!-- sms 문자 메시지 인증코드 인증 -->
	<select id="doAuth" parameterType="java.util.HashMap"
		resultType="java.util.HashMap">
		SELECT 'SUCC-AUTHCODE' AS RESULT
		FROM MSG_AUTH m
		WHERE
		m.PHONENUMBER = #{phone-number, jdbcType = VARCHAR}
		AND m.AUTHCODE =
		#{auth-code, jdbcType = VARCHAR}
		AND SYSDATE BETWEEN m.REGDATE AND
		m.EXPIREDATE
	</select>

</mapper>